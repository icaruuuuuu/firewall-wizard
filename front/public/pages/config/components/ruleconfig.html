<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Rule - Firewall Wizard</title>
  <link rel="stylesheet" href="../../../assets/css/config.css">
</head>

<body>

  <main class="container">
    <div class="card">

      <div class="header">
        <h2>üîê New Rule</h2>
        <p class="header-subtitle">Configure a nftable firewall rule</p>
      </div>

      <div class="form-container">

        <form id="ruleForm">

          <fieldset>
            <legend>üìù Rule Identification</legend>
            <div class="form-group">
              <label for="description">Description *</label>
              <input type="text" id="description" name="description"
                placeholder="Ex: Allow SSH only on administrative networks" required />
              <p class="help-text">Rule's description</p>
            </div>

            <div class="form-group">
              <label for="chainId">Chain *</label>
              <select id="chainId" name="chainId" required>
                <option value="">Select Chain...</option>
                <!-- Op√ß√µes ser√£o preenchidas dinamicamente com Chains do banco -->
                <!-- Exemplo: <option value="1">INPUT (filter table)</option> -->
              </select>
            </div>
          </fieldset>

          <fieldset>
            <legend>üéØ Matching Criteria</legend>
            <div class="form-group">
              <label for="matchType">Matching Type *</label>
              <select id="matchType" name="matchType" required>
                <option value="">Select match type...</option>
                <option value="interface">Interface</option>
                <option value="state">Connection State</option>
                <option value="protocol">Protocol</option>
                <option value="ip">IP Address</option>
                <option value="limit">Rate Limit</option>
                <option value="all">All Connections</option>
              </select>
            </div>

            <!-- Se√ß√µes espec√≠ficas para cada tipo de match -->
            <div id="match-interface" class="match-section" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label for="interface">Interface</label>
                  <input type="text" id="interface" name="interface" placeholder="Ex: eth0" />
                </div>

                <div class="form-group">
                  <label for="interfaceDir">Direction</label>
                  <select id="interfaceDir" name="interfaceDir">
                    <option value="iif">Input Interface (iif)</option>
                    <option value="oif">Output Interface (oif)</option>
                  </select>
                </div>
              </div>
            </div>

            <div id="match-state" class="match-section" style="display: none;">
              <div class="form-group">
                <label>Connection States</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" name="states" value="established" /> Established
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="states" value="related" /> Related
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="states" value="new" /> New
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="states" value="invalid" /> Invalid
                  </label>
                </div>
              </div>
            </div>

            <div id="match-protocol" class="match-section" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label for="protocol">Protocol</label>
                  <select id="protocol" name="protocol">
                    <option value="">Select...</option>
                    <option value="tcp">TCP</option>
                    <option value="udp">UDP</option>
                    <option value="icmp">ICMP</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="destPort">Destination Port</label>
                  <input type="text" id="destPort" name="destPort" placeholder="Ex: 22 or 80,443" />
                </div>

                <div class="form-group">
                  <label for="srcPort">Source Port</label>
                  <input type="text" id="srcPort" name="srcPort" placeholder="Ex: 1024:65535" />
                </div>
              </div>
            </div>

            <div id="match-ip" class="match-section" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label for="srcAddr">Source Address</label>
                  <input type="text" id="srcAddr" name="srcAddr" placeholder="Ex: 192.168.1.0/24" />
                </div>

                <div class="form-group">
                  <label for="destAddr">Destination Address</label>
                  <input type="text" id="destAddr" name="destAddr" placeholder="Ex: 10.0.0.0/8" />
                </div>
              </div>
            </div>

            <div id="match-limit" class="match-section" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label for="rate">Rate</label>
                  <input type="text" id="rate" name="rate" placeholder="Ex: 5/minute" value="5/minute" />
                </div>

                <div class="form-group">
                  <label for="burst">Burst</label>
                  <input type="number" id="burst" name="burst" placeholder="Ex: 10" value="10" min="1" />
                </div>
              </div>
            </div>

            <!-- Campo para a express√£o "match" completa -->
            <div class="form-group">
              <label for="match">Match Expression *</label>
              <textarea id="match" name="match" placeholder="Ex: 'tcp dport 22, ip saddr 192.168.1.0/24'" rows="3"
                required></textarea>
              <p class="help-text">Complete nftables match expression (criteria)</p>
            </div>
          </fieldset>

          <fieldset>
            <legend>‚ö° Statement (Action)</legend>
            <div class="form-group">
              <label for="statement">Statement *</label>
              <select id="statement" name="statement" required>
                <option value="">Select statement...</option>
                <option value="accept">Accept</option>
                <option value="drop">Drop</option>
                <option value="reject">Reject</option>
                <option value="log">Log</option>
                <option value="dnat">DNAT</option>
                <option value="snat">SNAT</option>
                <option value="masquerade">Masquerade</option>
              </select>
            </div>

            <div id="statement-dnat" class="statement-section" style="display: none;">
              <div class="form-group">
                <label for="natTarget">NAT Target</label>
                <input type="text" id="natTarget" name="natTarget" placeholder="Ex: 192.168.1.100:8080" />
              </div>
            </div>

            <div id="statement-log" class="statement-section" style="display: none;">
              <div class="form-row">
                <div class="form-group">
                  <label for="logPrefix">Log Prefix</label>
                  <input type="text" id="logPrefix" name="logPrefix" placeholder="Ex: Firewall-Denied:" />
                </div>

                <div class="form-group">
                  <label for="logLevel">Level</label>
                  <select id="logLevel" name="logLevel">
                    <option value="debug">Debug</option>
                    <option value="info">Info</option>
                    <option value="warn">Warn</option>
                    <option value="err">Error</option>
                  </select>
                </div>
              </div>
            </div>
          </fieldset>

          <fieldset>
            <legend>üîß Expression (Optional)</legend>
            <div class="form-group">
              <label for="expression">Expression</label>
              <textarea id="expression" name="expression"
                placeholder="Complete nftables rule (e.g., 'tcp dport 22, ip saddr 192.168.1.0/24 accept'). Leave empty to auto-generate."
                rows="3"></textarea>
              <p class="help-text">Full nftables rule. If empty, will be generated from match + statement.</p>
            </div>
          </fieldset>

          <div class="form-actions">
            <button type="button" onclick="window.history.back()" class="btn btn-secondary btn-cancel">‚Üê Cancel</button>
            <button type="submit" class="btn btn-primary">
              <span>‚úì</span> Save Rule
            </button>
          </div>

        </form>
      </div>

    </div>
  </main>

  <script type="module" src="../../../js/features/rules/ruleconfig.js"></script>

</body>

</html>